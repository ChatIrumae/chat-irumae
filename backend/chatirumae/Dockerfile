# ë¹Œë“œ ìŠ¤í…Œì´ì§€: Gradle + JDK21
FROM gradle:8.10.2-jdk17 AS builder
WORKDIR /app

# 1) ì˜ì¡´ì„± ìºì‹œìš©: build.gradleê³¼ wrapper ì„¤ì •ë§Œ ë³µì‚¬
COPY build.gradle settings.gradle gradle.* ./
# ì˜ì¡´ì„±ë§Œ ë¯¸ë¦¬ ë‹¤ìš´ë¡œë“œ (í…ŒìŠ¤íŠ¸ ì œì™¸)
RUN gradle dependencies --no-daemon

# 2) ì‹¤ì œ ì†ŒìŠ¤ ë³µì‚¬ ë° ë¹Œë“œ
COPY . .
RUN gradle clean build --no-daemon

# ëŸ°íƒ€ì„ ì´ë¯¸ì§€: Liberica JDK21 Alpine
FROM bellsoft/liberica-openjdk-alpine:17
WORKDIR /app

# ğŸ’¡ [ìˆ˜ì • í¬ì¸íŠ¸] Alpineì˜ íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €(apk)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜ì¡´ì„± ì„¤ì¹˜
# ë£¨íŠ¸ ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰í•´ì•¼ í•¨
USER root
RUN apk update && apk add --no-cache \
    udev \
    ttf-freefont \
    chromium

# ë³´ì•ˆì„ ìœ„í•´ non-root ìœ ì €ë¡œ ë‹¤ì‹œ ì „í™˜
USER bellsoft

COPY --from=builder /app/build/libs/*-SNAPSHOT.jar app.jar
EXPOSE 3001
ENTRYPOINT ["java","-jar","app.jar"]