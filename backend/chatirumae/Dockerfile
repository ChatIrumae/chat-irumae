# ë¹Œë“œ ìŠ¤í…Œì´ì§€: Gradle + JDK17 (ë³€ê²½ ì—†ìŒ)
FROM gradle:8.10.2-jdk17 AS builder
WORKDIR /app
COPY build.gradle settings.gradle gradle.* ./
RUN gradle dependencies --no-daemon
COPY . .
RUN gradle clean build --no-daemon

# =========================================================================

# ëŸ°íƒ€ì„ ì´ë¯¸ì§€: Liberica JDK17 Alpine
FROM bellsoft/liberica-openjdk-alpine:17
WORKDIR /app

# Alpine Linuxì˜ íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €(apk)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜ì¡´ì„± ì„¤ì¹˜
USER root
RUN apk update && apk add --no-cache \
    udev \
    ttf-freefont \
    chromium

# ë³´ì•ˆì„ ìœ„í•´ non-root ìœ ì €ë¡œ ë‹¤ì‹œ ì „í™˜
USER bellsoft

# ğŸ’¡ [ìˆ˜ì • í¬ì¸íŠ¸] --chown ì˜µì…˜ì„ ì¶”ê°€í•˜ì—¬ íŒŒì¼ ì†Œìœ ìë¥¼ bellsoftë¡œ ì§€ì •
COPY --chown=bellsoft:bellsoft --from=builder /app/build/libs/*-SNAPSHOT.jar app.jar

EXPOSE 3001
ENTRYPOINT ["java","-jar","app.jar"]